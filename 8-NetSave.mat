clear;clc;
addpath(' E:\DOC_BS_Stroke\code');
trks_name='CSTL,CSTR,FPTL,FPTR,ICPMCL,ICPMCR,ICPVCL,ICPVCR,LLL,LLR,MCP,MLL,MLR,POTPTL,POTPTR,SCPCRL,SCPCRR,SCPCTL,SCPCTR,SCPSCL,SCPSCR,STTL,STTR';
trks_name_=strsplit(trks_name,',');
nets_name='LH_Limbic,RH_Limbic,LH_Default,RH_Default,LH_Cont,RH_Cont,LH_SalVentAttn,RH_SalVentAttn,LH_DorsAttn,RH_DorsAttn,LH_SomMot,RH_SomMot,LH_vis,RH_vis';
nets_name_=strsplit(nets_name,',');
all_subname =dir('C:\Users\wangmiao\Downloads\230213networks_metrics\sub-DOC0*.txt');

for nsub=1:numel(all_subname)
    subdata = importfile([all_subname(nsub).folder,'\',all_subname(nsub).name], [1, Inf]);
    name=all_subname(nsub).name;
    out_mean=strcat(name(1:3),'_',name(5:11),'_Netmean');
    out_median=strcat(name(1:3),'_',name(5:11),'_Netmedian');
    out_std=strcat(name(1:3),'_',name(5:11),'_Netstd');
    out_count=strcat(name(1:3),'_',name(5:11),'_Netcount');
    out_volume=strcat(name(1:3),'_',name(5:11),'_Netvolume');
    
    net_median=zeros(23,14);
    net_mean=zeros(23,14);
    net_std=zeros(23,14);
    net_count=zeros(23,14);
    net_volume=zeros(23,14);

    for ntrk=1:numel(trks_name_)
        for nnet=1:numel(nets_name_)
            label=['maks_',trks_name_{ntrk},'_Atlas_',nets_name_{nnet},'_MNI'];
            index=find(~cellfun('isempty',strfind(string(subdata),label)));
            if length(index)==2
                metrics1=strsplit(subdata{index(1)+2},' ');
                net_mean(ntrk,nnet)=str2num(metrics1{2});
                net_median(ntrk,nnet)=str2num(metrics1{3});
                net_std(ntrk,nnet)=str2num(metrics1{4});
                net_count(ntrk,nnet)=str2num(metrics1{7});
                metrics2=strsplit(subdata{index(2)+1},' ');
                net_volume(ntrk,nnet)=str2num(metrics2{1});
            end
        end
    end
        
    eval(strcat(out_mean,'=net_mean;'));
    eval(strcat(out_median,'=net_median;'));
    eval(strcat(out_std,'=net_std;'));
    eval(strcat(out_count,'=net_count;'));
    eval(strcat(out_volume,'=net_volume;'));
    eval(strcat('save(''C:\Users\wangmiao\Downloads\',out_mean,'.mat''',',''',out_mean,''')'));
    eval(strcat('save(''C:\Users\wangmiao\Downloads\',out_median,'.mat''',',''',out_median,''')'));
    eval(strcat('save(''C:\Users\wangmiao\Downloads\',out_std,'.mat''',',''',out_std,''')'));
    eval(strcat('save(''C:\Users\wangmiao\Downloads\',out_count,'.mat''',',''',out_count,''')'));
    eval(strcat('save(''C:\Users\wangmiao\Downloads\',out_volume,'.mat''',',''',out_volume,''')'));
end
